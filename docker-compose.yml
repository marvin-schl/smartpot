version: "3.3"  # optional since v1.27.0
services:
  nodered:
    user: "1000:1000"
    build:
      context: .
      dockerfile: dockerfile_nodered
    ports:
      - "1880:1880"
    volumes:
      - smartpot_data:/home/pi/smartpot
      - nodered_data:/data
  smartpot:
    user: "0:1000"
    build:
      context: .
      dockerfile: dockerfile_smartpot
    privileged: true
    volumes:
    - smartpot_data:/data
    - ${PWD}/smartpot.ini:/home/smartpot/smartpot.ini
    - ${PWD}/smartpot.log:/home/smartpot/smartpot.log
    devices:
    - "/dev/i2c-1:/dev/i2c-1"
    - "/dev/gpiomem:/dev/gpiomem"
volumes:
  smartpot_data:
  nodered_data:
